<?xml version="1.0" encoding="UTF-8" ?>
<library>
<!--  -->

<resource name="_downIconRSC" src="resources/filesave.png" />

<class name="imageslistdraw" extends="view" width="280" height="270" bgcolor="0x4171B5">
	<view width="${ parent.width-2 }" height="${ parent.height-2 }" x="1" y="1" bgcolor="white" />

	<attribute name="uploadmodul" value="" type="string" />

    <method name="addFolder" args="foldername">
        //new listfolderdrag(this._table._listcontent,{uploadmodul:this.uploadmodul,foldername:foldername});
        new listfolderdrag(this._table._listcontent,{uploadmodul:this.uploadmodul,foldername:foldername,inserted:inserted});
    </method>
    
    <method name="addFile" args="filename,ext">
        //new listimagedrag(this._table._listcontent,{uploadmodul:this.uploadmodul,size:size,filename:filename,inserted:inserted,isimage:isimage});
        new listimagedrag(this._table._listcontent,{uploadmodul:this.uploadmodul,filename:filename+ext,filenamePure:filename,ext:ext});
    </method>
    
    <method name="addPpt" args="filename,ext">
        //new listimagedrag(this._table._listcontent,{uploadmodul:this.uploadmodul,size:size,filename:filename,inserted:inserted,isimage:isimage});
        new listppt(this._table._listcontent,{uploadmodul:this.uploadmodul,filename:filename+ext,filenamePure:filename,ext:ext});
    </method>
    
    <method name="resetList">
    	this._table.destroy();
    	new imagelistinnertable(this,{name:'_table'});
    </method>
    
    <method name="highlightItem" args="obj">
    	<![CDATA[
    		for (var i=0;i<this._table._listcontent.subviews.length;i++){
    			if (!this._table._listcontent.subviews[i].isPpt)
    				this._table._listcontent.subviews[i].setText('<font>'+this._table._listcontent.subviews[i].filenamePure+'</font>');
    		}
    		obj.setText('<font><b>'+obj.filenamePure+'</b></font>');
    	]]>
    </method>
    
	<imagelistinnertable name="_table" />
</class>

<class name="imagelistinnertable" extends="view" width="$once{ parent.width-4 }" height="$once{ parent.height-4 }" 
	bgcolor="white" x="2" y="2" clip="true">
    <view name="_listcontent" bgcolor="0x799FCE">
        <simplelayout name="_layout" axis="y" spacing="1" inset="1" />
        
        <remotecall funcname="deleteFile" remotecontext="$once{ canvas.mainservices }">
			<param><method name="getValue">return parent.String1;</method></param>
			<param><method name="getValue">return canvas.uploadmoduleimg;</method></param>
			<param><method name="getValue">return parent.String2;</method></param>
			<param><method name="getValue">return canvas.currentcourse;</method></param>
	        <handler name="ondata" args="value">	
	        	Debug.write("  deleteFile: ",value);     
		  		var tempSendArray = new Array ();
		  		tempSendArray[0] = 'fileslist';
		  		var nowTime = new Date();
		  		var datumsString = nowTime.getHours()+':'+nowTime.getMinutes();
		  		tempSendArray[1] = datumsString;
	  			Debug.write("Setting Message");
	  			tempSendArray[2] = 'newfile';
	  			tempSendArray[3] = canvas.currentusename;
		  		Debug.write("send: ",tempSendArray);
		  		canvas.objMessage = tempSendArray;
		  		rtc.sendMessage.doCall();        				
	        </handler> 
	 	</remotecall> 
    </view>
    <vscrollbar />
</class>

<class name="listimagedrag" extends="text" height="18" width="280" 
    onmouseover="this.setBGColor(0x799FCE)" onmouseout="this.setBGColor(white)" 
    bgcolor="white" text="$once{ this.filenamePure }" fontsize="10" >
    <handler name="onmousedown">
        //this.oninit.sendEvent();
       	new dragView(canvas,{filename:this.filename,filesid:1,refObj:this });
        LzModeManager.globalLockMouseEvents();
        this.onmouseout.sendEvent();     
        this.parent.parent.parent.highlightItem(this);
    </handler>
    <handler name="onmouseup">
    	<![CDATA[
    	if (this.getMouse('x')>=this.x && this.getMouse('x')<=(this.x+this.width) && this.getMouse('y')>=0 && this.getMouse('y')<=(0+this.height)){
    		Debug.write("okay inside");
  			this.__LZFileAddDirect();
  		}
  		]]>
    </handler>

    <attribute name="filename" value="" type="string" />
    <attribute name="filenamePure" value="" type="string" />
    <attribute name="ext" value="" type="string" />
    <attribute name="isPpt" value="false" type="boolean" />
    <attribute name="uploadmodul" value="" type="string" />

	<view resource="filedelete_rsc" x="$once{ parent.parent.parent.width -34 }" y="1" 
		onclick="parent.__LZFileDelete()" />
	<method name="__LZFileDownload">
		<![CDATA[
		Debug.write("Download File ",this);
		if (canvas.iswebrtmp){
			var downloadurl = '../../'+'lps-latest/DownloadHandler?fileName='+this.filename+'&moduleName='+this.uploadmodul+'&parentPath='+canvas.uploadmoduleimgfolder+'/'+'&roomName='+canvas.currentcourse;
		} else {
			var downloadurl = '../../'+'DownloadHandler?fileName='+this.filename+'&moduleName='+this.uploadmodul+'&parentPath='+canvas.uploadmoduleimgfolder+'/'+'&roomName='+canvas.currentcourse;
		}
        Debug.write(downloadurl);	
		LzBrowser.loadURL(downloadurl,'_parent');	
		]]>
	</method>
	<method name="__LZFileDelete">
		this.parent.deleteFile.String2 = canvas.uploadmoduleimgfolder+'/';
		this.parent.deleteFile.String1 = this.filename;
		this.parent.deleteFile.invoke();
	</method>
  
	<method name="__LZFileAddDirect">
		<![CDATA[
        var downloadurl = 'http://localhost:8080/lps-latest/DownloadHandler?fileName='+this.filename+'&moduleName='+canvas.uploadmoduleimg+'&parentPath='+canvas.uploadmoduleimgfolder+'/'+'&roomName='+canvas.currentcourse;
        Debug.write(downloadurl);        
        Debug.write("x,y: ",x,y);
        _drawarea.parent.clearAreaAndAddImage(downloadurl,0,0);
        this.parent.parent.parent.highlightItem(this);
        ]]>
	</method>
</class>

<class name="listfolderdrag" extends="text" height="18" width="280" 
    onmouseover="this.setBGColor(0x799FCE)" text="$once{ '     '+this.foldername }" 
    onmouseout="this.setBGColor(white)" bgcolor="white" >
    
    <handler name="onmouseup">
        this.__LZFileOpenFolder();
    </handler>

    <attribute name="foldername" value="" type="string" />
    <attribute name="uploadmodul" value="" type="string" />
 
	<view resource="folder_yellow_rsc" x="1" onclick="parent.__LZFileOpenFolder()" y="1" />

	<view resource="filedelete_rsc" x="$once{ parent.parent.parent.width -34 }" 
		y="1" onclick="parent.__LZFileDelete()" />

	<method name="__LZFileDelete">
		this.parent.deleteFile.String2 = canvas.uploadmoduleimgfolder;
		this.parent.deleteFile.String1 = this.foldername;
		this.parent.deleteFile.invoke();
	</method>
  
	<method name="__LZFileOpenFolder">
        canvas.addFolderSequence(this.foldername);
        canvas.mainservices.getListOfFiles.invoke();
	</method>

</class>

<class name="listppt" extends="text" fontsize="10" height="18" width="280" 
    onmouseover="this.setBGColor(0x799FCE)" onmouseout="this.setBGColor(white)" bgcolor="white"
    text="$once{ '    '+this.filename }" >

    <attribute name="filename" value="" type="string" />
    <attribute name="filenamePure" value="" type="string" />
    <attribute name="ext" value="" type="string" />
    <attribute name="isPpt" value="true" type="boolean" />
    <attribute name="uploadmodul" value="" type="string" />

	<view resource="folder_yellow_rsc" x="1" onclick="parent.__LZFileDownload()" y="1" />

	<view resource="_downIconRSC" x="$once{ parent.parent.parent.width -54 }" 
		y="1" onclick="parent.__LZFileDownload()" />
	<view resource="filedelete_rsc" x="$once{ parent.parent.parent.width -34 }" 
		y="1" onclick="parent.__LZFileDelete()" />
		
	<method name="__LZFileDownload">
		<![CDATA[
		Debug.write("Download File ",this);
		if (canvas.iswebrtmp){
			var downloadurl = '../../'+'lps-latest/DownloadHandler?fileName='+this.filename+'&moduleName='+this.uploadmodul+'&parentPath='+canvas.uploadmoduleimgfolder+'/'+'&roomName='+canvas.currentcourse;
		} else {
			var downloadurl = '../../'+'DownloadHandler?fileName='+this.filename+'&moduleName='+this.uploadmodul+'&parentPath='+canvas.uploadmoduleimgfolder+'/'+'&roomName='+canvas.currentcourse;
		}
        Debug.write(downloadurl);	
		LzBrowser.loadURL(downloadurl,'_parent');	
		]]>
	</method>
	<method name="__LZFileDelete">
		this.parent.deleteFile.String2 = canvas.uploadmoduleimgfolder+'/';
		this.parent.deleteFile.String1 = this.filename;
		this.parent.deleteFile.invoke();
	</method>

</class>


</library>