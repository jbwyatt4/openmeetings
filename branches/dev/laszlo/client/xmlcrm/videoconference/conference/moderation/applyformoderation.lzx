<?xml version="1.0" encoding="UTF-8" ?>
<library>

<class name="useritem" extends="view" bgcolor="$once{ canvas.basebgcolorizer }" width="$once{ parent.width }" height="20">
	<attribute name="streamid" value="0" type="string" />
	<attribute name="username" value="" type="string" />
	<attribute name="hasAnswered" value="false" type="boolean" />
	<attribute name="answer" value="false" type="boolean" />
	
	<view name="inner" width="$once{ parent.width-2 }" height="$once{ parent.height-2 }" x="1" y="1"
		onmouseover="this.setBGColor(canvas.baseMousecolorizer)"
		onmouseout="this.setBGColor(0xFFFFFF)" bgcolor="0xFFFFFF">
		<labeltext text="$once{ parent.parent.streamid }" width="50" />
		<labeltext text="$once{ parent.parent.username }" x="50" width="300" />
		<labeltext name="answer" labelid="88" x="350" width="140" />
	</view>
</class>
    
<class name="applyformoderation"  extends="labelexplorerbox" labelid="81"
	width="500" height="250" x="14" y="-300" closable="true">
	
	<attribute name="applymessage" value="null" />
	
	<labeltext labelid="93" y="30" x="2" />

	<handler name="oninit">
		canvas.currentModApply = this;
		this.getClientListScope.call();
		this.applymessage = new Array();
		this.applymessage[0] = 'applyforMod';
		this.sendMessageWithClient.call();
	</handler>
	
	<method name="setUserAnswer" args="value">
		<![CDATA[
		Debug.write("*** setUserAnswer: ",value);

		var t = this.userslist.userslist.userslist[value.client.streamid];
		Debug.write(" t: ",t);
		t.hasAnswered = true;
		var answer = value.message[1];
		Debug.write("answer: ",answer);
		if (answer=='ok'){
			t.inner.answer.setText(canvas.getLabelName(94));
			t.answer = true;
		} else {
			t.inner.answer.setText(canvas.getLabelName(95));
			t.answer = false;
		}
		]]>
		this.checkForUpdates();
	</method>
	
	<method name="rejectUser" args="value">
		this.userslist.userslist.userslist[value.streamid].destroy();
		this.checkForUpdates();
	</method>
	
	<method name="checkForUpdates">
		<![CDATA[
		var b = true;
		for (var i=0;i<this.userslist.userslist.userslist.subviews.length;i++){
			Debug.write("itemID : ",this.userslist.userslist.userslist.subviews[i]);
			if (!this.userslist.userslist.userslist.subviews[i].answer){
				b=false;
				break;
			}
		}
		if (b) this.applyButton.setAttribute('labelid',96);
		this.applyButton.setAttribute('enabled',b);
		]]>
	</method>
	
	<netremotecall name="getClientListScope" funcname="getClientListScope" remotecontext="$once{ canvas.thishib }" >        
       	<handler name="ondata" args="value">
       		<![CDATA[
           	//The onResult-Handler will be called be the rtmpconnection
           	Debug.write("INSTANCE getClientListScope : ",value);
			for (var eg in value){
				Debug.write("value: ",eg,value,parent.userslist.userslist.userslist);
				if (canvas.streamid!=value[eg].streamid)	new useritem(parent.userslist.userslist.userslist,{name:value[eg].streamid,username:value[eg].username,streamid:value[eg].streamid});
				Debug.write("value: ",eg,value,parent.userslist.userslist.userslist);
			}
           ]]>
		</handler>   
    </netremotecall> 
     
    <netremotecall name="sendMessageWithClient" funcname="sendMessageWithClient" remotecontext="$once{ canvas.thishib }" >  
    	<netparam name="vars"><method name="getValue">return parent.parent.applymessage;</method></netparam>
        <handler name="ondata" args="value">
        	<![CDATA[
            //The onResult-Handler will be called be the rtmpconnection
            Debug.write("sendMessageWithClient : ",value);

            ]]>
        </handler>   
    </netremotecall>      
	
	<view name="userslist" y="60" x="4" height="140" clip="true" width="492" bgcolor="$once{ canvas.basebgcolorizer }" >
		<view name="userslist" y="1" x="1" height="138" clip="true" width="490" bgcolor="0xFFFFFF" >
			<view name="userslist" layout="axis:y;spacing:2" width="$once{ parent.width }" />
			<vscrollbar />
		</view>
	</view>	
	
    <simplelabelbutton name="applyButton" labelid="88" width="200" x="80" y="218" enabled="false">
    	<handler name="onclick">
    		rtc.setModerator.call();
    		this.parent.close();
    	</handler>
    </simplelabelbutton>
    
    <simplelabelbutton labelid="83" width="200" x="290" y="218" >
    	<handler name="onclick">
    		this.parent.close();
    	</handler>
    </simplelabelbutton>
    
    <animator attribute="y" to="20" duration="1000" start="true"/>
    
</class>

</library>