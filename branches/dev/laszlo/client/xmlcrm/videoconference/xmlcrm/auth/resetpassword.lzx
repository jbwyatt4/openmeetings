<?xml version="1.0" encoding="UTF-8" ?>
<library>

<class name="resetpassword" extends="labelexplorerbox" labelid="325"
    docking="true" resizeable="false" closable="false" 
	width="360" x="350" height="160">
    
    <handler name="onclose">
    	if (this.childObj!=null) this.childObj.close();
    </handler>
    
    <handler name="oninit">canvas.resetHash
        var pressEnter = new LzDelegate(this, "login");
        LzKeys.callOnKeyCombo(pressEnter, ["enter"]);
		this.getUserByHash.doCall();
	</handler>  
    
    <netremotecallhib name="getUserByHash" funcname="userservice.getUserByHash" 
		remotecontext="$once{ canvas.thishib }" activeErrorHandler="true" >      
        <netparam><method name="getValue"> return canvas.sessionId;</method></netparam> 
        <netparam><method name="getValue"> return canvas.resetHash;</method></netparam> 
        <handler name="ondata" args="value">
			<![CDATA[
            	//The onResult-Handler will be called be the rtmpconnection
				if (value<0) {
					parent.close();
				} else {
					parent.username.setText(value.login);
					LzFocus.setFocus(parent.pass1,true);
				}
			]]>
        </handler>  
    </netremotecallhib>	
	
	<method name="sendValues">
		<![CDATA[
			if (this.pass1.getText()!=this.pass1.getText()){
				new rpcerrordialog(canvas.main_content._content.inner,{errorid:-6});
			} else if (this.pass1.getText().length<4) {
				new rpcerrordialog(canvas.main_content._content.inner,{errorid:-7});
			} else {
				this.resetPassByHash.doCall();
			}
		]]>
	</method>
	
    <netremotecallhib name="resetPassByHash" funcname="userservice.resetPassByHash" 
		remotecontext="$once{ canvas.thishib }" activeErrorHandler="true"
		isCallBackHandler="true" >      
		<attribute name="tempValue" value="0" type="number" />
        <netparam><method name="getValue"> return canvas.sessionId;</method></netparam> 
        <netparam><method name="getValue"> return canvas.resetHash;</method></netparam>
		<netparam><method name="getValue"> return parent.parent.pass1.getText();</method></netparam>  
        <handler name="ondata" args="value">
            //The onResult-Handler will be called be the rtmpconnection
			Debug.write(value);
			this.tempValue = value;
        </handler>  
		<handler name="sendCallBack">
			if (this.tempValue==-8) {
				Debug.write("success");
				parent.close();
				var authLogin = new checkLoginData(canvas.main_content._content.inner);
				authLogin.username.setText(parent.username.getText());
				authLogin.userpass.setText(parent.pass1.getText());
			}
		</handler>
    </netremotecallhib>		
	
    <labeltext labelid="326" width="200" y="24" x="2"/>
        <labeltext name="username" y="24" x="140" width="170" />
   
    <labeltext labelid="328" width="200" y="54" x="2"/>
        <customedittext password="true" name="pass1" y="54" x="140" width="170" />
	
    <labeltext labelid="329" width="200" y="84" x="2"/>
        <customedittext password="true" name="pass2" y="84" x="140" width="170" />
	
    <simplelabelbutton name="_btn" labelid="327" width="120" x="230" 
		y="$once{ parent.height-40 }" onclick="parent.sendValues()" />   
	
</class>    

</library>