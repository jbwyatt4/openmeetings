<?xml version="1.0" encoding="UTF-8" ?>
<library>
 
<class name="contentsavewindow" extends="labelexplorerbox" labelid="145"
    docking="true" width="264" x="200" y="0" height="200">
    
    <attribute name="saveObj" value="null" />
    <attribute name="refObj" value="null" />
    <attribute name="processNextIndex" value="0" type="number" />
	<attribute name="errorid" value="0" type="number" />
    
    <handler name="oninit">
        LzModeManager.makeModal(this);
        this.startSave();
    </handler>
    
    <handler name="onclose">
        LzModeManager.release(this);
    </handler>
    
    <method name="startSave">
    	<![CDATA[
    	for (var i=0;i<this.saveObj.length;i++){
    		this.saveObj[i].prepareCall();
    	}
    	this.processNext();
    	]]>
    </method>
	
	<method name="errorByCode" args="eCode">
		this.errorid = eCode;
		this.getErrorByCode.doCall();
	</method>
    
    <method name="processNext">
    	<![CDATA[
    	Debug.write("processNext: ",this.saveObj.length,this.processNextIndex);
    	if (this.saveObj.length>this.processNextIndex){
    		this.saveObj[this.processNextIndex].returnObj=this;
    		this.saveObj[this.processNextIndex].doCall();
    		this.processNextIndex++;
    	} else {
    		Debug.write("update process complete");
    		this.refObj.onsavecompleted.sendEvent();
    		this.close();
    	}
    	]]>
    </method>
	
	<netremotecallhib name="getErrorByCode" funcname="errorservice.getErrorByCode" remotecontext="$once{ canvas.thishib }" >      
		<netparam name="vars1"><method name="getValue"> return canvas.sessionId; </method></netparam>
		<netparam name="vars2"><method name="getValue"> return parent.parent.errorid; </method></netparam>
		<handler name="ondata" args="value">
			Debug.write("getErrorByCode ",value);
			//this.parent.destroy();
			this.parent._errortext.setText(value.errmessage);
		</handler>
	</netremotecallhib>		
	
	<text name="_errortext" multiline="true" width="$once{ parent.width }" 
		height="$once{ parent.height-50 }" y="22" />
	
	<simplelabelbutton labelid="163" x="90" width="150" y="176" >
		<handler name="onclick">
			this.parent.close();
		</handler>
	</simplelabelbutton>
    
</class>

</library>