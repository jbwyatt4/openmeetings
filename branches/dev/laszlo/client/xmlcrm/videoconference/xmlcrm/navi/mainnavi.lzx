<?xml version="1.0" encoding="UTF-8" ?>
<library>

    <!-- lz.menubutton -->
<include href="lz/floatinglist.lzx" />
<include href="lz/textlistitem.lzx" />
        
<include href="menuassets.lzx" />

        
<!--
bgcolor="$once{ canvas.baseMousecolorizer }"
	onmouseover=" this.setBGColor(canvas.baseMouseOvercolorizer) "
    onmouseout=" this.setBGColor(canvas.baseMousecolorizer) " 
-->
<class name="linemenuitems" extends="button"
	onclick="parent.selectItem(this)" fontstyle="bold">

	<attribute name="rscleft" value="mainmenu_left_rsc" type="string" />
	<attribute name="rscmid" value="mainmenu_mid_rsc" type="string" />
	<attribute name="rscright" value="mainmenu_right_rsc" type="string" />
    
    <attribute name="selected" value="false" type="boolean" />
    <attribute name="action" value="" type="string" />
    <attribute name="open" value="false" type="boolean" />
    <attribute name="isleaf" value="false" type="boolean" />    
    <attribute name="depth" value="2" type="number" />
    <attribute name="text" value="" type="string" />

	<!--
    <view name="n" layout="axis:x;spacing:0" width="${ parent.width }" >
		
	    <view name="_left" resource="$once{ parent.parent.rscleft }" />
	    <view name="_mid" resource="$once{ parent.parent.rscmid }" stretches="width" 
	    	width="${ parent.width-40 }" />
	    <view name="_right" resource="$once{ parent.parent.rscright }" />
		
    </view>
    -->
</class>

<class name="mainselectHandlerBar" layout="axis:x;spacing:0" >
	<attribute name="_selected" value="null" />
	<method name="selectItem" args="obj">
		if (this._selected!=null) this._selected.setAttribute('selected',false);
		this._selected = obj;
		this._selected.setAttribute('selected',true);
	</method>
</class>

<class name="subsubtreeitem" extends="linemenuitems"  
	rscleft="subsubmenu_left_rsc" rscmid="subsubmenu_mid_rsc" rscright="subsubmenu_right_rsc">  
    <attribute name="list" value="null" />
    <handler name="onclick"> 
        <![CDATA[
        if (this.isleaf && this.action){
            //Debug.write("action: ",this.action);
            if (this.depth==1){
                loadContent(this,null,null);
            } else if (this.depth==2){
                loadContent(this,this.parent,null);
            } else if (this.depth==3){
                loadContent(this,this.parent,this.parent.parent);
            }
        }
        ]]>
    </handler>  
	<!--
    <text x="8" y="2" height="20" resize="true" fontsize="11" name="_cbtext"
        fontstyle="bold" text="$once{parent.text}" />
     -->   
</class>

<class name="subtreeitem" extends="linemenuitems"  
	rscleft="submenu_left_rsc" rscmid="submenu_mid_rsc" rscright="submenu_right_rsc"> 
    <handler name="onclick"> 
    	<![CDATA[
        parent.parent.clearSubSubItemList();
    	if (this.isleaf && this.action){
			//Debug.write("action: ",this.action);
            if (this.depth==1){
                loadContent(this,null,null);
            } else if (this.depth==2){
                loadContent(this,this.parent,null);
            } else if (this.depth==3){
                loadContent(this,this.parent,this.parent.parent);
            }
		}
		]]>
	</handler>	
	<!--
    <text x="8" y="4" height="24" resize="true" fontsize="12" name="_cbtext"
        fontstyle="bold" text="$once{parent.text}" />
     -->
</class>


<class name="mainnavitree" extends="linemenuitems" y="2" > 

    <handler name="onclick"> 
    	<![CDATA[
    	this.parent.parent.clearAllSubItemLists();
    	if (this.isleaf && this.action){
			//Debug.write("action: ",this.action);
            if (this.depth==1){
                loadContent(this,null,null);
            } else if (this.depth==2){
                loadContent(this,this.parent,null);
            } else if (this.    depth==3){
                loadContent(this,this.parent,this.parent.parent);
            }
		}
		
        //Debug.write("this.list: ",this.list,this.list.length);
        if (this.list != null && this.list.length!=0) {
            for (var i=0;i<this.list.length;i++){
            	//Debug.write("this.list[i]: ",this.list[i]);
            	var t = new subtreeitem(this.parent.parent._subcontent,{list:this.list[i].subnavi,depth:2,text:this.list[i].label.value,open:this.list[i].isleaf,isleaf:this.list[i].isleaf,action:this.list[i].action});
            }
        }	
        //Debug.write("this.parent.parent._subcontent: ",this.parent.parent._subcontent);
		]]>
	</handler>	
    <!--
    <text x="10" y="4" resize="true" fontsize="14" name="_cbtext"
        fontstyle="bold" text="$once{parent.text}" />
	 -->
</class>
    <!-- width="${ parent.width }" height="26" -->
 
    
<class name="meetingsmenulistitem" extends="textlistitem">
    <attribute name="action" value="" type="string" />
    <attribute name="list" value="null" />
    <attribute name="isopen" value="false" type="boolean" />
    <attribute name="isleaf" value="false" type="boolean" />   
</class>     
    
    
<class name="menumeetingsfloatinglist" extends="floatinglist" width="140" >
    
    <handler name="onselect" args="obj">
        Debug.write(this,obj);
        this.owner.parent.sendOpenMenu(this.owner._menuRef,false);
        loadContent(obj,null,null);
    </handler>    
     
    <method name="open">
        this.setAttribute('visible',true);
        LzModeManager.makeModal( this );
    </method>
    
    <method name="close">
        this.setAttribute('visible',false);
        LzModeManager.release( this );
    </method>   
    
    <!--- @keywords private -->
    <method name="passModeEvent" args="event,view" > 
        <![CDATA[
            Debug.write("tt : ",event,view);
            // Once a view has been made modal, this method
            // gets called by the system ONLY when a user clicks on
            // a view 'outside' the contents of this view.  
            if ( event == 'onmousedown' ) {
                if ( view != null ) { // view is a clickable view
                    // view is not LITERALLY part of the class hierarchy but
                    // it maybe part of the floatingview of this menu, or part
                    // of the parent view that contains this menu 
                    Debug.write("tt : ",view);
                    
                } else { // view is not a clickable view so close the menu
                    //this.open(false);
                    this.owner.parent.sendOpenMenu(this.owner._menuRef,false);
                }
            }
            // since a menu is not strictly modal ( 'fragile' ), always return
            // true to pass the event to the object that was clicked on
            return true; 
        ]]> 
    </method>     
   
</class>   

<class name="mainmenumeetingsitem" extends="button" height="$once{ parent.height-2 }" >
        
    <attribute name="action" value="" type="string" />
    
    <attribute name="_menuRef" value="null" />
    <attribute name="isopen" value="false" type="boolean" />
    <attribute name="isleaf" value="false" type="boolean" />
    <attribute name="list" value="null" />
    
    <handler name="oninit">
        <![CDATA[
            if (list!=null && list.length!=0){
                this._menuRef = new menumeetingsfloatinglist(this,{name:'menu1',visible:false,atach:'bottom'});
                for (var i=0;i<this.list.length;i++) {
                    new meetingsmenulistitem(this._menuRef,{list:this.list[i].subnavi,text:this.list[i].label.value,open:this.list[i].isleaf,isleaf:this.list[i].isleaf,action:this.list[i].action});
                }
            }
        ]]>
    </handler>
    
    <handler name="onmousedown">
        this.parent.sendOpenMenu(this._menuRef,true);
        Debug.write(myresultnavi,canvas.myresultnavi);
        if (this.isleaf) {
            loadContent(this,null,null);
        }
    </handler>
    
    
</class>    
    
    
<class name="mainnavi" extends="view" height="30" width="${ canvas.width }"
    layout="axis:x;spacing:0" bgcolor="$once{canvas.basebgcolorizer}">
        
    <attribute name="naviObject" value="null" />
    <attribute name="currentmenu" value="null" />
    
    <method name="sendOpenMenu" args="menuref,open">
        if (this.currentmenu==menuref) open=false;
        if (this.currentmenu!=null) this.currentmenu.close();
        this.currentmenu = menuref;
        if (menuref!=null) {
            menuref.clearSelection();
            if (open){
                menuref.open();
            } else {
                this.currentmenu=null;
                menuref.close();
            }
        }
    </method>
    
    <!---
    	Initialize Menu
   	-->
    <handler name="oninit">
    	<![CDATA[  
    	var value = this.naviObject;
    	for (var i=0;i<value.length;i++){
    		//var t1 = new mainnavitree(t,{list:value[i].mainnavi,depth:1,text:value[i].label.value,open:value[i].isleaf,isleaf:value[i].isleaf,action:value[i].action});
			//Debug.write("value[i]: ",value[i]);
    		var t1 = new mainmenumeetingsitem(this,{list:value[i].mainnavi,isleaf:value[i].isleaf,text:value[i].label.value,action:value[i].action});
    	}
        //Debug.write("this: ",this);
    	]]>
    </handler>

</class>
    
    <!--
    <view x="0" y="0" name="_innercontent" layout="axis:y;spacing:0">

       	<method name="clearmainItemList">
       		<![CDATA[
       		for (var i in this._content.subviews){
       			this._content.subviews[i].destroy();
       		}
       		]]>
       	</method>
       	
       	<method name="clearSubItemList">
       		<![CDATA[
       		//Debug.write("clearSubItemList");
       		for (var i in this._subcontent.subviews){
       			//Debug.write("item deleted: ",this._subcontent.subviews[i]);
       			this._subcontent.subviews[i].destroy();
       		}
       		]]>
       	</method>
       	
       	<method name="clearSubSubItemList">
       		<![CDATA[
       		//Debug.write("clearSubSubItemList");
       		for (var i in this._subsubcontent.subviews){
       			//Debug.write("item deleted: ",this._subsubcontent.subviews[i]);
       			this._subsubcontent.subviews[i].destroy();
       		}
       		]]>
       	</method>   
        
        <method name="clearAllSubItemLists">
        	this.clearSubItemList();
        	this.clearSubSubItemList();
        </method>       	   
        
        <mainselectHandlerBar name="_content" bgcolor="$once{ canvas.basebgcolorizer }" height="32" width="${ canvas.width }" />
        
        <mainselectHandlerBar name="_subcontent" bgcolor="$once{ canvas.basebgcolorizer }" height="30" />
        
        <mainselectHandlerBar name="_subsubcontent" bgcolor="$once{ canvas.basebgcolorizer }" />
            
    </view>
    -->    

</library>